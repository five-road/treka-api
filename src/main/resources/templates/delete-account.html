<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Treka - 회원 탈퇴</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');

    :root {
      --primary-color: #3498db;
      --danger-color: #e74c3c;
      --light-gray-color: #f4f4f4;
      --dark-gray-color: #333;
      --text-color: #555;
      --border-color: #ddd;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: var(--light-gray-color);
      color: var(--text-color);
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      background-color: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
      box-sizing: border-box;
      text-align: left;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 20px;
    }

    .header h1 {
      color: var(--primary-color);
      font-weight: 700;
      font-size: 2.5rem;
      margin: 0;
    }

    h2 {
      color: var(--dark-gray-color);
      font-size: 1.5rem;
      margin-bottom: 15px;
    }

    .content-section {
      margin-bottom: 25px;
    }

    .content-section ul {
      list-style-type: '✓ ';
      padding-left: 20px;
    }

    .content-section li {
      margin-bottom: 8px;
    }

    .warning {
      background-color: #fffbe6;
      border: 1px solid #ffe58f;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 25px;
      font-weight: 500;
    }

    .delete-button {
      background-color: var(--danger-color);
      color: white;
      border: none;
      padding: 15px 25px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.3s, transform 0.2s;
    }

    .delete-button:hover {
      background-color: #c0392b;
      transform: translateY(-2px);
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      font-size: 0.9rem;
      color: #999;
    }
  </style>
</head>
<body>

<div class="container">
  <header class="header">
    <h1>Treka</h1>
  </header>

  <main>
    <div class="content-section">
      <h2>회원 탈퇴 안내 및 계정 삭제 요청</h2>
      <p>안녕하세요. 저희 Treka를 이용해주셔서 감사합니다.</p>
      <p>회원 탈퇴 및 계정 삭제를 원하실 경우, 아래 내용을 반드시 확인해주세요.</p>
    </div>

    <div class="content-section">
      <h3>계정 삭제 시 삭제되는 정보</h3>
      <div class="warning">
        계정 삭제 시 회원님의 모든 활동 기록과 개인 정보가 복구 불가능하게 영구 삭제됩니다.
      </div>
      <ul>
        <li><strong>회원 정보:</strong> 회원가입 시 입력한 이름, 이메일 주소 등</li>
        <li><strong>활동 기록:</strong> 작성한 게시물, 댓글, 좋아요, 그룹 목록 등 모든 활동 기록</li>
      </ul>
    </div>

    <div class="content-section">
      <h3>계정 삭제 절차</h3>
      <p>계정 삭제는 신중하게 결정해주세요. 아래 버튼을 누르면 최종 확인 절차가 진행됩니다.</p>
      <ol>
        <li>아래 '계정 삭제' 버튼을 눌러주세요.</li>
        <li>최종 확인 팝업창에서 '확인'을 누르면 계정 삭제가 즉시 완료됩니다.</li>
      </ol>
    </div>

    <button id="delete-btn" class="delete-button">계정 삭제</button>

    <div class="content-section" style="margin-top: 25px;">
      <h3>데이터 보관 및 기타 안내</h3>
      <p>부적절한 활동으로 인해 이용 약관에 따라 계정이 정지된 경우, 관련 데이터는 서비스 운영을 위해 보관될 수 있습니다.</p>
      <p>계정 삭제 관련 궁금한 점이 있으시면 언제든지 고객센터로 문의해주세요.</p>
    </div>
  </main>

  <footer class="footer">
    <p>&copy; 2024 Treka | 이제윤</p>
  </footer>
</div>

<script>
  document.getElementById('delete-btn').addEventListener('click', function() {
    // 사용자에게 최종 확인을 받습니다.
    const isConfirmed = window.confirm(
        '정말로 계정을 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.'
    );

    if (isConfirmed) {
      // 로그인 시 localStorage에 저장된 AccessToken을 가져옵니다.
      // 실제 프로젝트에서는 토큰 저장 방식에 맞게 수정해야 합니다. (예: sessionStorage, 쿠키)
      const accessToken = localStorage.getItem('accessToken');

      if (!accessToken) {
        alert('로그인 정보가 없습니다. 다시 로그인 후 시도해주세요.');
        // 필요 시 로그인 페이지로 리디렉션
        // window.location.href = '/login';
        return;
      }

      // fetch API를 사용하여 서버에 DELETE 요청을 보냅니다.
      fetch('/api/v1/users/me', {
        method: 'DELETE',
        headers: {
          // JWT 토큰을 Authorization 헤더에 담아 보냅니다.
          'Authorization': 'Bearer ' + accessToken
        }
      })
      .then(response => {
        // HTTP 상태 코드가 204 No Content이면 성공입니다.
        if (response.status === 204) {
          alert('회원 탈퇴가 성공적으로 처리되었습니다. 이용해주셔서 감사합니다.');
          // 성공 후 토큰을 삭제하고 로그인 페이지나 메인 페이지로 이동합니다.
          localStorage.removeItem('accessToken');
          window.location.href = '/'; // 메인 페이지로 이동
        } else {
          // 401, 403, 500 등 다른 상태 코드 처리
          return response.json().then(err => {
            throw new Error(err.message || '알 수 없는 오류가 발생했습니다.');
          });
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('회원 탈퇴 중 오류가 발생했습니다: ' + error.message);
      });
    }
  });
</script>

</body>
</html>