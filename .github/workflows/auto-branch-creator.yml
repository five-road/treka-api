# ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„
name: ğŸ¤– Auto Branch Creator

# ì‹¤í–‰ ì¡°ê±´: 'issues' ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê³ , ê·¸ íƒ€ì…ì´ 'opened'(ìƒì„±)ì¼ ë•Œ ì‹¤í–‰
on:
  issues:
    types: [opened]

# ì‹¤í–‰í•  ì‘ì—…ë“¤
jobs:
  create_branch_job:
    # ì‹¤í–‰ í™˜ê²½ ì§€ì •
    runs-on: ubuntu-latest
    steps:
      # 1. ì´ìŠˆ ì •ë³´ì—ì„œ ë¸Œëœì¹˜ ì´ë¦„ í˜•ì‹ ë§Œë“¤ê¸°
      - name: Format branch name
        id: format_branch_name
        # ì´ìŠˆ ì œëª©ì„ ì†Œë¬¸ìë¡œ ë°”ê¾¸ê³ , ê³µë°± ë° íŠ¹ìˆ˜ë¬¸ìë¥¼ í•˜ì´í”ˆ(-)ìœ¼ë¡œ ë³€ê²½
        # ìµœì¢… í˜•ì‹: ì´ìŠˆë²ˆí˜¸-ì´ìŠˆì œëª©
        run: |
          branch_name=$(echo "${{ github.event.issue.title }}" | iconv -t ascii//TRANSLIT | sed -r s/[^a-zA-Z0-9]+/-/g | sed -r s/^-+\|-+$//g | tr A-Z a-z)
          echo "branch=feature/${{ github.event.issue.number }}-${branch_name}" >> $GITHUB_OUTPUT

      # 2. ë§Œë“  ë¸Œëœì¹˜ ì´ë¦„ìœ¼ë¡œ ì‹¤ì œ ë¸Œëœì¹˜ ìƒì„±
      - name: Create branch
        # git ì €ì¥ì†Œì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ê¸°ë³¸ ì•¡ì…˜
        uses: actions/checkout@v4
        with:
          # ìƒì„±ëœ ë¸Œëœì¹˜ë¡œ ë°”ë¡œ ì²´í¬ì•„ì›ƒ
          create-branch: true
          # ìœ„ ë‹¨ê³„ì—ì„œ ë§Œë“  ë¸Œëœì¹˜ ì´ë¦„ì„ ì‚¬ìš©
          branch: ${{ steps.format_branch_name.outputs.branch }}
      
      # 3. ì´ìŠˆì— ë¸Œëœì¹˜ê°€ ìƒì„±ë˜ì—ˆìŒì„ ëŒ“ê¸€ë¡œ ì•Œë¦¼
      - name: Post comment to issue
        uses: peter-evans/create-or-update-comment@v4
        with:
          # ëŒ“ê¸€ì„ ë‹¬ ì´ìŠˆ ë²ˆí˜¸
          issue-number: ${{ github.event.issue.number }}
          # ëŒ“ê¸€ ë‚´ìš©
          body: |
            âœ… ì´ ì´ìŠˆì™€ ì—°ê²°ëœ ë¸Œëœì¹˜ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
            ë¸Œëœì¹˜: `${{ steps.format_branch_name.outputs.branch }}`
